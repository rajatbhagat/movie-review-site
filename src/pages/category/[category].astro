---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ReviewCard from '../../components/ReviewCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const reviews = await getCollection('reviews');
  const allGenres = [...new Set(reviews.flatMap((r) => r.data.genre))];

  return allGenres.map((genre) => ({
    params: { category: genre.toLowerCase() },
    props: {
      genre,
      reviews: reviews
        .filter((r) => r.data.genre.map((g) => g.toLowerCase()).includes(genre.toLowerCase()))
        .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()),
    },
  }));
}

interface Props {
  genre: string;
  reviews: Awaited<ReturnType<typeof getCollection<'reviews'>>>;
}

const { genre, reviews } = Astro.props;
---

<BaseLayout title={`${genre} Movies`} description={`Browse our ${genre.toLowerCase()} movie reviews`}>
  <div class="max-w-7xl mx-auto px-4 py-12">
    <div class="mb-8">
      <a href="/" class="text-gray-400 hover:text-white transition text-sm mb-4 inline-block">
        ‚Üê Back to Home
      </a>
      <h1 class="text-4xl font-display font-bold">
        {genre} <span class="text-primary-400">Movies</span>
      </h1>
      <p class="text-gray-400 mt-2">{reviews.length} review{reviews.length !== 1 ? 's' : ''}</p>
    </div>

    {reviews.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {reviews.map((review) => (
          <ReviewCard
            title={review.data.title}
            slug={review.slug}
            rating={review.data.rating}
            poster={review.data.poster}
            genre={review.data.genre}
            year={review.data.year}
            excerpt={review.data.excerpt}
          />
        ))}
      </div>
    ) : (
      <div class="text-center py-16">
        <p class="text-gray-400">No reviews in this category yet.</p>
      </div>
    )}
  </div>
</BaseLayout>
